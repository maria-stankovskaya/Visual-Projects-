Ссылка на набор данных с Kaggle:  https://www.kaggle.com/datasets/joebeachcapital/diamonds































Исследовательский анализ данных (обязательная часть)


Описание данных


Набор данных содержит характеристики более чем 50000 различных бриллиантов.
Таблица данных включает в себя следующие показатели:
1.carat – это мера веса бриллианта. Один карат эквивалентен 0,2 грамма.
2.cut – Огранка определяет, как необработанный бриллиант превращается в готовый бриллиант. Более качественные огранки создают более симметричные и блестящие бриллианты. Огранка имеет 5 уровней: “Fair,” “Good,” “Very Good,” “Premium,” “Ideal.”
3.color– определяет цвет бриллианта. Бесцветные бриллианты считаются лучше бриллиантов с желтым оттенком. Алмазы содержат бриллианты 7 различных цветов, обозначенных разными буквами. Бриллианты «D» - «F» считаются бесцветными, в то время как бриллианты «G» - «J» имеют очень тусклый цвет.
4.clarity – определяет чистоту бриллианта. Бриллианты часто содержат дефекты, такие как трещины или минеральные вкрапления. Чем меньше и менее заметны дефекты бриллианта, тем выше его чистота. Чистота имеет 8 уровней: от «I1» (наихудший) до «IF» (наилучший).
5.depth – мера размера алмаза в миллиметрах.
6.table – мера размера алмаза в миллиметрах.
7.x - мера размера алмаза в миллиметрах.
8.y - мера размера алмаза в миллиметрах.
9.z - мера размера алмаза в миллиметрах.
10.price - стоимость.
Анализ данных позволит определить какие характеристики бриллианта больше всего влияют на его стоимость.
Решим  также задачу автоматического предсказания стоимости бриллианта с помощью моделей машинного обучения.

Этапы выполнения задания

1.Обработка данных

В Knime производилась очистка и подготовка данных, обучение модели, построение прогноза и других необходимых показателей. 

На первом этапе создадим новый Workflow Diamonds_project и выполним загрузку CSV файла с помощью узла CSV Reader. Проверим, чтобы типы данных были интерпретированы верно:





Исключение дубликатов

Далее проверим датасет на наличие повторяющихся значений. Для этого выберем узел duplicate row filter. Для проверки выберем все столбцы. В результате проверки нашлось 146 дубликатов, которые были удалены фильтром:
 




Проверка на пропущенные значения
Проверим датасет на пропуск с помощью узла Missing Value. Как видим, пропущенных значений в столбцах нет:




2.Первичная аналитика данных

Проверить качество данных и провести первичную аналитику можно с помощью средств визуализации. Воспользуемся узлом Statistics View. В готовой таблице видно, в каких диапазонах находятся наши признаки:




Заметим, что есть явно ошибочный выброс по измерениям x,y,z  - нулевые значения. Такая строка единственная. Следует ее удалить. Воспользуемся для этого узлом Raw Filter  и снова посмотрим статистику:




С помощью узла Box Plot мы можем видеть выбросы в значениях веса carat  и, соответственно, стоимости price. Также наблюдается единичный верхний выброс по параметру измерения z, что , очевидно, указывает на наличие одного бриллианта очень нестандартной формы либо на ошибку в данных. Такую запись целесообразно удалить, тем более, что судя по описанию этого экземпляра, он не обладает другими экстремальными признаками ( экстремально высокой ценой, например, за камень нестандартной формы), что скорее всего указывает на ошибку в данных:












 
Также посмотрим распределение цены бриллиантов по категоральным признакам:
По признаку cut - огранка:




Распределение цены по признаку color:




Распределение цены по признаку clarity:


Посмотрим также матрицу корреляций числовых признаков. Будем использовать фильтрацию столбцов с помощью узла Column Filter  (возьмем только числовые столбцы) и построим матрицу с помощью узла Linear Correlation:



Судя по коэффициентам корреляции, цена камня больше всего зависит  от его веса и размера, что логично. Но мы посмотрим с помощью графика Scatter plot Matrix насколько выражена эта зависимость. Используем для этого узел Scatter Plot Matrix.




Как видим, эта зависимость не всегда является линейной. При этом мелкие камни(до 0,5 карат) явно выделяются в отдельную ценовую категорию. Это очень важное наблюдение, которое необходимо учесть при дальнейшей подготовке данных для обучения моделей, так как есть риск, что:
- Модель будет недооценивать цену для бриллиантов > 0.5 карат
- Переоценивать для бриллиантов < 0.5 карат
- Не сможет уловить нелинейную зависимость.



Машинное обучение


3.Создание и обучение модели

C помощью модели ответим на вопрос: “Какова стоимость бриллианта с заданными характеристиками?” Для этого проведем дополнительную обработку данных с помощью разных узлов. 

Прежде всего создадим новый признак is_large_carat, указывающий принадлежит ли камень к категории крупных (> 0.5 карат) с помощью узла Rule Engine:




Также  необходимо уменьшить влияние масштаба для признака carat. Для этого мы используем логарифмическое преобразование с помощью узла Math Formula, а также нормализацию с помощью узла Normalize:








Теперь распределение признака carat выглядит лучше:




Теперь переведем в числовой формат категориальные признаки. Используем узел Category To Number:



Для обработанных данных используем встроенную возможность обучения модели с помощью технологии H2O.ai - используем H2O AutoML:
 

В результате лучшей оказалась ансамблевая модель - StackedEnsemble (использует простые модели типа GLM, Random Forest, Gradient Boosting вместе, для создания наиболее эффективного алгоритма предсказаний). Ее показатели:
MAE = 270.202 (средняя абсолютная ошибка в USD)
RMSE = 541.693


Протестируем модель на тестовых данных и получим следующие оценки:


Как видим, для нашей модели R² = 0.982 на тестовых данных, что является очень хорошим результатом.
 


4.Выводы по исследовательской части проекта

В результате комплексного анализа данных о более чем 50 000 бриллиантов была разработана прогнозная модель исключительной точности, демонстрирующая коэффициент детерминации R² = 0.98. Это означает, что модель объясняет 98% вариативности цен на бриллианты, устанавливая новый стандарт точности в ювелирной аналитике.
Симбиоз платформ KNIME и H2O AutoML доказал свою эффективность как идеальная среда для построения ML-решений:
KNIME обеспечила бесшовный EDA-пайплайн и препроцессинг данных;
H2O AutoML автоматизировал подбор и оптимизацию алгоритмов;
Stacked Ensemble модель объединила синергетический эффект множества алгоритмов.
Разработанное решение позволяет:
Точно оценивать рыночную стоимость бриллиантов по объективным параметрам;
Оптимизировать ценообразование и закупочную стратегию;
Минимизировать субъективизм в оценке драгоценностей.




















Платформы B I (обязательная часть)
Визуализация в Power BI

Этапы выполнения задания

5.Обработка данных

На первом этапе в Knime производилась очистка и подготовка данных, в результате которой из датасета были удалены дубликаты и обработаны ошибки (вбросы). Готовые данные мы переносим в Power BI для дальнейшей обработки. 


6.Расширение модели данных ( добавление таблицы календаря)

В Power Query искуственно создадим таблицу календаря:
Сгенерируем случайные даты в диапазоне 2022-2024 годов
Добавим временные разрезы: год, месяц
Создадим связь между таблицами diamonds и Calendar

Создаем пустой запрос Calendar и пишем для него следующий код:


В Power Query для запроса diamonds создадим новый столбец Price Category -  с указанием ценового сегмента бриллианта:


Также создадим столбец индексов в таблице diamonds и установим связь с таблицей Calendar:








7.Создание необходимых KPI с использованием DAX

Создадим ключевые метрики:

Total Revenue = SUM(diamonds[price]) - общая выручка


Avg Price = AVERAGE(diamonds[price]) - средняя цена бриллианта


Total Diamonds = COUNTROWS(diamonds) - количество проданных бриллиантов


Avg Price per Carat = DIVIDE([Total Revenue], SUM(diamonds[carat])) - средняя цена 
за карат


Premium Diamonds Ratio = DIVIDE(
    CALCULATE([Total Diamonds], diamonds[price] > 5000),
[Total Diamonds]) - доля бриллиантов премиального ценового сегмента.


Total Premium Revenue = CALCULATE(
    SUM(Diamonds[price]),
Diamonds[Price Category] = "Премиум") - выручка премиального сектора


Total Premium Diamonds = CALCULATE(
    COUNTROWS(Diamonds),
    Diamonds[Price Category] = "Премиум") - количество бриллиантов премиального сектора.




8.Визуализация в Power BI

Для визуализации данных в Power BI можно использовать различные варианты для графиков и диаграмм, которые помогут выявить основные тенденции и зависимости в данных.

4.1 Качественные показатели

На этой странице отчета пранализируем влияние основных качественных характеристик бриллиантов на их стоимость:








 Анализ цен по огранке и цвету
Тип графика: Столбчатая диаграмма с группировкой
Ось X: Категория огранки (cut)
Ось Y: Средняя цена за карат (Avg Price per Carat)
Легенда: Цветовая группа (color)
Описание: Анализ влияния качества огранки и цвета на стоимость бриллиантов


Анализ цен по чистоте (прозрачности)
Тип графика: Линейчатая диаграмма с группировкой
Ось X: Средняя цена за карат (Avg Price per Carat)
Ось Y: Прозрачность (Clarity)
Описание: Анализ влияния показателя прозрачности на стоимость бриллиантов


Общее количество бриллиантов по ценовой категории
Тип графика: Диаграмма дерева
Категория: Ценовая категория (Price Category)
Значения:  Количество (Total Diamonds)
Описание: Анализ доли брилиантов по ценовой категории




Анализ цен по весу (карату) 
Тип графика: Точечная диаграмма
Ось X: Carat
Ось Y: Цена (Price) 
Условно по: Цвет (Color)
Размер точек: Количество ( Total Diamonds)
Описание: Анализ зависимости цены от веса бриллианта



4.2 Операционные показатели


На этой странице отчета мы проанализируем динамику продаж по времени, особенно обращая внимание на премиальный сектор:




Динамика продаж по времени
Тип графика: Ленточная диаграмма
Ось X: Дата ( включена иерархия  год>месяц>день)
Ось Y: Выручка 
Описание: Тренды продаж бриллиантов по времени




ТОП 5 по ценовой категории
Тип визуализации: Таблица 
Данные: price, carat, cut,color,clarity ( основные качественные показатели)
Фильтр: топ 5 по максимальной цене
Описание: Топ 5 самых дорогих бриллиантов









Динамика продаж премиальных бриллиантов по времени
Тип графика: Диаграмма с областями
Ось X: Year, Month
Ось Y: Количество премиальных бриллиантов (Total Premium Diamonds)
Вспомогательная ось Y: Выручка по премиальному сектору
Описание: Тренды продаж премиальных бриллиантов по времени




Распределение выручки по ценовой категории 
Тип графика: Круговая диаграмма
Оси:
oCategory field: Категория цены (Price Category)
oValues: Выручка
Описание: Показать распределение выручки по категориям цены (Бюджетные, Средние, Премиум)




4.2 Ключевые факторы влияния

На этой странице отчета мы проанализируем основные ключевые характеристики, которые влияют на стоимость бриллианта - его качественные характеристики. Используем для этого встроенную визуализацию «Ключевые факторы влияния»:

Анализ: Price
Объяснение по: Carat, Cut,Clarity, Color: 





9.Выводы 

Ключевые закономерности:
1. Ценовые закономерности
Вес (carat) является доминирующим фактором стоимости - составляет ~65% влияния на цену
Наблюдается экспоненциальный рост цены с увеличением веса: каждый дополнительный карат увеличивает стоимость в среднем на 180%
Качество огранки дает значительную премию: разница между "Fair" и "Ideal" составляет 45-68%

2. Премиальный сегмент
Премиальные бриллианты (>$5,000) составляют 25% ассортимента, но формируют 60% общей выручки
Наибольшую маржинальность демонстрируют комбинации: Ideal cut + Color D-F + Clarity VVS-IF
Стоимость карата в премиальном сегменте в 3-4 раза выше, чем в бюджетном


3. Временные тренды
Выявлена стабильная сезонность с пиками продаж в IV квартале (+25% к среднемесячным показателям)

Оптимальные бизнес-стратегии
Для ритейлеров:
✓ Увеличить долю премиальных комбинаций в ассортименте
✓ Сфокусироваться на бриллиантах 1-2 карат - оптимальное соотношение спроса и маржи
✓ Использовать сезонность для планирования закупок и промо-акций
Для покупателей:
✓ Наилучшее соотношение цена/качество: Very Good cut + Color G-H + Clarity VS1-VS2
✓ Инвестиционная привлекательность: бриллианты >2 карат 

Рекомендации:

1.Диверсифицировать ассортимент с акцентом на средний и премиальный сегменты
2.Внедрить динамическое ценообразование на основе выявленных закономерностей
3.Разработать программы лояльности для покупателей премиальных категорий

 Заключение:
Проведенный анализ демонстрирует высокую предсказуемость рынка бриллиантов на основе объективных параметров. Разработанная аналитическая система позволяет оптимизировать бизнес-процессы и принимать обоснованные решения в области ценообразования, закупок и маркетинга.
Наибольший потенциал роста сосредоточен в сегменте бриллиантов 1.5-2.5 карата с комбинацией качества огранки "Very Good/Premium" и цветом G-H.
